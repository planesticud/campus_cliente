FROM node AS my-app-build
WORKDIR /app
COPY . .
RUN apt-get update -y
RUN apt-get install -y zip
RUN rm -rf node_modules
RUN npm i
RUN npm install node-sass
RUN npm run lint
RUN npm run build --build-optimizer=false
FROM nginx:1.16.0-alpine
RUN mkdir -p /data
WORKDIR /data
COPY --from=my-app-build . .
COPY --from=my-app-build /app/nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=my-app-build /app/dist  /usr/share/nginx/html

# expose port 80
EXPOSE 80

# run nginx
CMD ["nginx", "-g", "daemon off;"]
